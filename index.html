<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Galaxia para ti ‚ú®</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body, html { 
      width: 100%; 
      height: 100vh; 
      overflow: hidden; 
      background: #000; 
      font-family: 'Arial', sans-serif;
    }
    
    .background-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      overflow: hidden;
    }
    
    .bg-image {
      position: absolute;
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0;
      transition: opacity 0.8s ease-in-out;
      z-index: 0;
    }
    
    .bg-image.active {
      opacity: 0.4;
    }
    
    .bg-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at center, rgba(0,0,0,0.2) 0%, rgba(0,0,0,0.7) 100%);
      z-index: 1;
    }
    
    canvas { 
      position: absolute; 
      top: 0; 
      left: 0; 
      z-index: 2;
    }
    
    .content { 
      position: absolute; 
      top: 50%; 
      left: 50%; 
      transform: translate(-50%, -50%); 
      text-align: center; 
      color: #fff; 
      z-index: 3; 
      text-shadow: 0 0 20px #ff00ff, 0 0 40px #00ffff;
      max-width: 90%;
    }
    
    h1 { 
      font-size: clamp(2rem, 8vw, 4rem); 
      margin: 0 0 20px 0; 
      color: #fff; 
      animation: glow 2s infinite alternate;
      letter-spacing: 3px;
    }
    
    p { 
      font-size: clamp(1rem, 4vw, 1.8rem); 
      margin: 10px 0; 
      opacity: 0.95;
    }
    
    .controls {
      margin-top: 30px;
      display: flex;
      flex-direction: column;
      gap: 15px;
      align-items: center;
    }
    
    button { 
      padding: 15px 30px; 
      font-size: clamp(1rem, 2vw, 1.5rem); 
      background: linear-gradient(135deg, #ff00ff, #00ffff);
      color: #000; 
      border: none; 
      border-radius: 50px; 
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: bold;
      box-shadow: 0 0 20px rgba(255, 0, 255, 0.5);
    }
    
    button:hover { 
      transform: scale(1.05);
      box-shadow: 0 0 40px rgba(0, 255, 255, 0.8);
    }
    
    button:active {
      transform: scale(0.98);
    }
    
    .visualizer {
      display: flex;
      justify-content: center;
      align-items: flex-end;
      gap: 4px;
      margin-top: 20px;
      height: 80px;
    }
    
    .bar {
      width: 6px;
      background: linear-gradient(180deg, #ff00ff, #00ffff);
      border-radius: 3px;
      box-shadow: 0 0 10px #ff00ff;
    }
    
    .song-info {
      margin-top: 15px;
      font-size: clamp(0.9rem, 2vw, 1.2rem);
      color: #00ffff;
      min-height: 30px;
    }
    
    .photo-indicator {
      margin-top: 15px;
      font-size: 0.9rem;
      color: #ff00ff;
      display: flex;
      justify-content: center;
      gap: 8px;
    }
    
    .dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(255, 0, 255, 0.3);
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .dot.active {
      background: #00ffff;
      box-shadow: 0 0 10px #00ffff;
      transform: scale(1.3);
    }
    
    @keyframes glow { 
      from { text-shadow: 0 0 20px #ff00ff; } 
      to { text-shadow: 0 0 60px #00ffff; } 
    }
    
    input[type="file"] { display: none; }
  </style>
</head>
<body>
  <div class="background-container" id="bgContainer">
    <div class="bg-overlay"></div>
  </div>
  
  <canvas id="canvas"></canvas>
  
  <div class="content">
    <h1>‚ú® Galaxia para ti ‚ú®</h1>
    <p>Te Amo Muchote Mis Ojitos Brillantes üíõ</p>
    <p>Adaptado con ‚ù§Ô∏è para ti</p>
    
    <div class="controls">
      <button id="uploadBtn">üéµ Elegir canci√≥n</button>
      <input type="file" id="songInput" accept="audio/*">
      <button id="photoBtn">üì∏ Agregar fotos (m√°x 4)</button>
      <input type="file" id="photoInput" accept="image/*" multiple>
      <div class="song-info" id="songInfo"></div>
      <div class="photo-indicator" id="photoIndicator"></div>
      <div class="visualizer" id="visualizer"></div>
    </div>
    
    <audio id="player" loop></audio>
  </div>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d', { alpha: false });
    const songInput = document.getElementById('songInput');
    const player = document.getElementById('player');
    const uploadBtn = document.getElementById('uploadBtn');
    const songInfo = document.getElementById('songInfo');
    const visualizer = document.getElementById('visualizer');
    const photoBtn = document.getElementById('photoBtn');
    const photoInput = document.getElementById('photoInput');
    const bgContainer = document.getElementById('bgContainer');
    const photoIndicator = document.getElementById('photoIndicator');
    
    let stars = [];
    let analyser = null;
    let dataArray = null;
    let audioContext = null;
    let backgroundImages = [];
    let currentBgIndex = 0;
    let bgSwitchInterval = null;
    
    // Crear contexto de audio
    function initAudioContext() {
      if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const source = audioContext.createMediaElementAudioSource(player);
        analyser = audioContext.createAnalyser();
        analyser.fftSize = 256;
        source.connect(analyser);
        analyser.connect(audioContext.destination);
        dataArray = new Uint8Array(analyser.frequencyBinCount);
      }
    }
    
    // Optimizaci√≥n del canvas
    function resize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    // Clase Star mejorada
    class Star {
      constructor() {
        this.reset();
      }
      
      reset() {
        this.x = Math.random() * canvas.width;
        this.y = Math.random() * canvas.height;
        this.size = Math.random() * 2.5 + 0.5;
        this.speed = Math.random() * 0.5 + 0.2;
        this.opacity = Math.random() * 0.8 + 0.2;
        this.hue = Math.random() * 60;
      }
      
      update() {
        this.opacity = Math.sin(Date.now() * 0.003 + this.x) * 0.4 + 0.6;
        this.y += this.speed;
        if (this.y > canvas.height) {
          this.y = 0;
          this.x = Math.random() * canvas.width;
        }
      }
      
      draw() {
        ctx.fillStyle = `hsla(${this.hue}, 100%, 50%, ${this.opacity})`;
        ctx.fillRect(this.x, this.y, this.size, this.size);
      }
    }

    // Crear galaxia
    for(let i = 0; i < 800; i++) {
      stars.push(new Star());
    }

    // Crear barras del visualizador
    function createBars(count) {
      visualizer.innerHTML = '';
      for (let i = 0; i < count; i++) {
        const bar = document.createElement('div');
        bar.className = 'bar';
        visualizer.appendChild(bar);
      }
    }
    createBars(32);

    // Actualizar indicador de fotos
    function updatePhotoIndicator() {
      photoIndicator.innerHTML = '';
      backgroundImages.forEach((_, index) => {
        const dot = document.createElement('div');
        dot.className = 'dot' + (index === currentBgIndex ? ' active' : '');
        dot.addEventListener('click', () => switchToPhoto(index));
        photoIndicator.appendChild(dot);
      });
    }

    // Cambiar foto de fondo
    function switchToPhoto(index) {
      if (backgroundImages.length === 0) return;
      
      // Remover clase active de todas las im√°genes
      const images = bgContainer.querySelectorAll('.bg-image');
      images.forEach((img, i) => {
        img.classList.remove('active');
      });
      
      // Activar nueva imagen
      currentBgIndex = index % backgroundImages.length;
      if (images[currentBgIndex]) {
        images[currentBgIndex].classList.add('active');
      }
      updatePhotoIndicator();
    }

    // Auto-cambiar fotos cada 8 segundos
    function startAutoSwitchPhotos() {
      if (bgSwitchInterval) clearInterval(bgSwitchInterval);
      
      bgSwitchInterval = setInterval(() => {
        if (backgroundImages.length > 1) {
          switchToPhoto((currentBgIndex + 1) % backgroundImages.length);
        }
      }, 8000);
    }

    // Manejar carga de fotos
    photoBtn.addEventListener('click', () => {
      photoInput.click();
    });
    
    photoInput.addEventListener('change', (e) => {
      const files = Array.from(e.target.files).slice(0, 4); // M√°ximo 4 fotos
      
      if (files.length === 0) return;
      
      // Limpiar im√°genes anteriores
      const previousImages = bgContainer.querySelectorAll('.bg-image');
      previousImages.forEach(img => img.remove());
      backgroundImages = [];
      currentBgIndex = 0;
      
      // Cargar nuevas im√°genes
      files.forEach((file, index) => {
        const reader = new FileReader();
        
        reader.onload = (event) => {
          const img = document.createElement('img');
          img.src = event.target.result;
          img.className = 'bg-image';
          if (index === 0) img.classList.add('active');
          
          img.onload = () => {
            bgContainer.appendChild(img);
            backgroundImages.push(img);
            updatePhotoIndicator();
            
            if (backgroundImages.length === files.length) {
              startAutoSwitchPhotos();
            }
          };
        };
        
        reader.readAsDataURL(file);
      });
      
      photoBtn.textContent = `üì∏ ${files.length} foto${files.length > 1 ? 's' : ''} cargada${files.length > 1 ? 's' : ''}`;
    });

    // Animaci√≥n principal
    function animate() {
      ctx.fillStyle = 'rgba(0, 0, 0, 0.08)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      stars.forEach(star => {
        star.update();
        star.draw();
      });
      
      if (analyser && dataArray) {
        analyser.getByteFrequencyData(dataArray);
        const bars = visualizer.querySelectorAll('.bar');
        const barCount = bars.length;
        
        bars.forEach((bar, index) => {
          const dataIndex = Math.floor((index / barCount) * dataArray.length);
          const value = (dataArray[dataIndex] / 255) * 100;
          bar.style.height = Math.max(5, value) + '%';
        });
      }
      
      requestAnimationFrame(animate);
    }
    animate();

    // Manejo de archivos de audio
    uploadBtn.addEventListener('click', () => {
      songInput.click();
    });
    
    songInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        initAudioContext();
        
        if (audioContext.state === 'suspended') {
          audioContext.resume().then(() => {
            playAudio(file);
          });
        } else {
          playAudio(file);
        }
      }
    });
    
    function playAudio(file) {
      player.src = URL.createObjectURL(file);
      player.play();
      songInfo.textContent = `üéµ ${file.name}`;
      uploadBtn.textContent = 'üéµ Cambiar canci√≥n';
    }
    
    // Permitir click para reproducir
    document.addEventListener('click', () => {
      if (audioContext && audioContext.state === 'suspended') {
        audioContext.resume();
      }
    });
  </script>
</body>
  </html>
